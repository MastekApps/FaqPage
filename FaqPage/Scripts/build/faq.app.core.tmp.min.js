"use strict";function RequestError(error){error instanceof SP.ClientRequestFailedEventArgs?(this.stackTrace=error.get_stackTrace(),this.message=error.get_message(),this.correlation=error.get_errorTraceCorrelationId(),this.errorCode=error.get_errorCode(),this.details=error.get_errorDetails(),this.errorType=error.get_errorTypeName()):"string"==typeof error&&(this.message=error)}function BaseListItem(item){var e=Function.validateParameters(arguments,[{name:"item",type:SP.ListItem}],!0);if(e)throw e;this.item=item,this.id=item.get_id(),this.created=item.get_item(FAQ.Fields.Created),this.createdBy=item.get_item(FAQ.Fields.CreatedBy),this.modified=item.get_item(FAQ.Fields.Modified),this.modifiedBy=item.get_item(FAQ.Fields.ModifiedBy),this.title=item.get_item(FAQ.Fields.Title),this.fileDirRef=item.get_item(FAQ.Fields.FileDirRef)}function ListRepository(listUrl,listItemConstructor){var e=Function.validateParameters(arguments,[{name:"listUrl",type:String},{name:"listItemConstractor",type:Function}],!0);if(e)throw e;this._listUrl=listUrl,this._listItemConstructor=listItemConstructor,this._context=SP.ClientContext.get_current(),this._loadListDeffered=FAQ.ListService.getListByUrl(this._listUrl),this._loadListDeffered.done(Function.createDelegate(this,function(list){this._list=list})),this.folder=null}function AppPartsConfigRepository(listUrl){AppPartsConfigRepository.initializeBase(this,[listUrl,AppPartConfigListItem])}function FaqRepository(listUrl){FaqRepository.initializeBase(this,[listUrl,FaqListItem])}function AppPartConfigListItem(item){item&&(AppPartConfigListItem.initializeBase(this,[item]),this.wpId=item.get_item(FAQ.Fields.AppPartsConfig.AppPartId),this.configData=JSON.parse(item.get_item(FAQ.Fields.AppPartsConfig.Config)))}function FaqListItem(item){if(item){FaqListItem.initializeBase(this,[item]),this.question=item.get_item(FAQ.Fields.FaqList.Question),this.answer=item.get_item(FAQ.Fields.FaqList.Answer),this.order=item.get_item(FAQ.Fields.FaqList.Order),this.expanded=item.get_item(FAQ.Fields.FaqList.Expanded);var settings=item.get_item(FAQ.Fields.FaqList.FolderSettings);this.faqSetSettings=settings?JSON.parse(settings):{}}}Type.registerNamespace("FAQ.Fields.FaqList"),Type.registerNamespace("FAQ.Fields.AppPartsConfig"),Type.registerNamespace("FAQ.Lists"),Type.registerNamespace("FAQ.ErrorCodes"),Type.registerNamespace("FAQ.ContentTypes"),FAQ.ErrorCodes.FolderAlreadyExists=-2130245363,FAQ.ErrorCodes.IllegalName=-2130575245,FAQ.Lists.FaqUrl="Lists/Faq",FAQ.Lists.AppPartsConfigUrl="Lists/AppPartsConfig",FAQ.Fields.Modified="Modified",FAQ.Fields.Created="Created",FAQ.Fields.ModifiedBy="Editor",FAQ.Fields.CreatedBy="Author",FAQ.Fields.ID="ID",FAQ.Fields.FSObjType="FSObjType",FAQ.Fields.Title="Title",FAQ.Fields.FileLeafRef="FileLeafRef",FAQ.Fields.FileDirRef="FileDirRef",FAQ.Fields.ContentTypeId="ContentTypeId",FAQ.Fields.FaqList.Question="FAQQuestion",FAQ.Fields.FaqList.Answer="FAQAnswer",FAQ.Fields.FaqList.Order="FAQOrder",FAQ.Fields.FaqList.Expanded="FAQExpanded",FAQ.Fields.FaqList.FolderSettings="FAQFolderSettings",FAQ.Fields.AppPartsConfig.AppPartId="WebPartId",FAQ.Fields.AppPartsConfig.Config="WebPartConfig",FAQ.ContentTypes.FaqFodlerId="0x012000B611673586B24704B0EF576127543759",RequestError.registerClass("RequestError"),FAQ.ListService=function(){var loadListDeffered=$jq.Deferred(),context=SP.ClientContext.get_current(),lists=context.get_web().get_lists();return context.load(lists,"Include(DefaultViewUrl)"),context.executeQueryAsync(function(){loadListDeffered.resolve()},function(sender,error){loadListDeffered.reject(new RequestError(error)),alert(String.fromat(FAQRS.ErrorLoadingList))}),{getListByUrl:function(listUrl){var def=$jq.Deferred();return loadListDeffered.done(function(){for(var enumerator=lists.getEnumerator();enumerator.moveNext();){var list=enumerator.get_current();if(-1!=list.get_defaultViewUrl().indexOf(listUrl))return void def.resolve(list)}}),def.promise()}}}(),BaseListItem.registerClass("BaseListItem"),ListRepository.prototype={getItems:function(){return this._getItemsByQuery(SP.CamlQuery.createAllItemsQuery())},getItemById:function(id){var e=Function.validateParameters(arguments,[{name:"id",type:Number}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var item=this._list.getItemById(id);this._context.load(item);var self=this;this._context.executeQueryAsync(function(){var resultItem=new self._listItemConstructor(item);deferred.resolve(resultItem)},function(sender,error){deferred.reject(new RequestError(error))})})),deferred.promise},getItemsByIds:function(ids){var e=Function.validateParameters(arguments,[{name:"ids",type:Array,elementType:Number}]);if(e)throw e;var camlBuilder=new CamlBuilder,caml=camlBuilder.Where().CounterField(FAQ.Fields.ID).In(ids).ToString(),query=new SP.CamlQuery;return query.set_viewXml(String.format("<View><Query>{0}</Query></View>",caml)),this._getItemsByQuery(query)},getItemsInsideFolders:function(folderNames){var e=Function.validateParameters(arguments,[{name:"folderNames",type:Array,elementType:String}]);if(e)throw e;var self=this,camlBuilder=new CamlBuilder,caml=camlBuilder.Where().TextField(FAQ.Fields.FileDirRef).In(folderNames.map(function(folderName){var folderRelUrl=self._getFolderRelativeUrl(folderName);return folderRelUrl.startsWith("/")&&(folderRelUrl=folderRelUrl.substring(1)),folderRelUrl})).ToString(),query=new SP.CamlQuery;return query.set_viewXml(String.format('<View Scope="RecursiveAll"><Query>{0}</Query></View>',caml)),this._getItemsByQuery(query)},getLastItem:function(){var camlBuilder=new CamlBuilder,caml=camlBuilder.Where().CounterField(FAQ.Fields.ID).NotEqualTo(0).OrderByDesc(FAQ.Fields.ID).ToString(),query=new SP.CamlQuery;return query.set_viewXml(String.format("<View><Query>{0}</Query><RowLimit>1</RowLimit></View>",caml)),this._getItemByQuery(query)},getRootFolders:function(){var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var camlBuilder=new CamlBuilder,caml=camlBuilder.Where().IntegerField(FAQ.Fields.FSObjType).EqualTo(1).ToString(),camlQuery=new SP.CamlQuery;camlQuery.set_viewXml(String.format("<View><Query>{0}</Query></View>",caml));var items=this._list.getItems(camlQuery),self=this;this._context.load(items),this._context.executeQueryAsync(function(){for(var folders=[],itemsEnumerator=items.getEnumerator();itemsEnumerator.moveNext();){var item=itemsEnumerator.get_current();
//FIX for Item folder - default, can't figure out how to prevent its creation
"Item"!==item.get_item(FAQ.Fields.Title)&&folders.push(new self._listItemConstructor(item))}deferred.resolve(folders)},function(sender,error){deferred.reject(new RequestError(error))})})),deferred.promise},saveItem:function(model){var e=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(e)throw e;return!model.id||model.id<1?this._addItem(model):this._updateItem(model)},deleteItem:function(model){var e=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var item=this._list.getItemById(model.id);this._context.load(item),item.deleteObject(),this._context.executeQueryAsync(function(){deferred.resolve()},function(sender,error){deferred.reject(new RequestError(error))})})),deferred.promise},createFolder:function(folderName){var e=Function.validateParameters(arguments,[{name:"folderName",type:String}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var folder=new SP.ListItemCreationInformation;folder.set_underlyingObjectType(SP.FileSystemObjectType.folder),folder.set_leafName(folderName);var folderItem=this._list.addItem(folder);folderItem.set_item("Title",folderName),folderItem.update(),this._context.load(folderItem),this._context.executeQueryAsync(function(){deferred.resolve(folderItem)},function(sender,error){deferred.reject(new RequestError(error))})})),deferred.promise},_createDeferred:function(){return angular.injector(["ng"]).get("$q").defer()},_addItem:function(model){var e=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var itemCreateInfo=new SP.ListItemCreationInformation;this.folder&&itemCreateInfo.set_folderUrl(this._getFolderRelativeUrl());var newItem=this._list.addItem(itemCreateInfo);this._setFieldValues(newItem,model);var self=this;newItem.update(),this._context.load(newItem),this._context.executeQueryAsync(function(){var resultItem=new self._listItemConstructor(newItem);deferred.resolve(resultItem)},function(sender,error){deferred.reject(new RequestError(error))})})),deferred.promise},_updateItem:function(model){var e=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var item=this._list.getItemById(model.id);this._context.load(item),this._setFieldValues(item,model);var self=this;item.update(),this._context.executeQueryAsync(function(){var resultItem=new self._listItemConstructor(item);deferred.resolve(resultItem)},function(sender,args){deferred.reject(new RequestError(args))})})),deferred.promise},_setFieldValues:function(item,model){item.set_item(FAQ.Fields.Title,model.title),model.fileLeafRef&&item.set_item(FAQ.Fields.FileLeafRef,model.fileLeafRef)},_getFolderRelativeUrl:function(folderName){var folder=folderName||this.folder,webRelativeUrl=_spPageContextInfo.webServerRelativeUrl.endsWith("/")?_spPageContextInfo.webServerRelativeUrl:_spPageContextInfo.webServerRelativeUrl+"/";return String.format("{0}{1}/{2}",webRelativeUrl,this._listUrl,folder)},_getItemsByQuery:function(camlQuery){var e=Function.validateParameters(arguments,[{name:"camlQuery",type:SP.CamlQuery}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&camlQuery.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var items=this._list.getItems(camlQuery);this._context.load(items);var self=this;this._context.executeQueryAsync(function(){for(var itemsEnumerator=items.getEnumerator(),resultItemList=[];itemsEnumerator.moveNext();)resultItemList.push(new self._listItemConstructor(itemsEnumerator.get_current()));deferred.resolve(resultItemList)},function(sender,args){deferred.reject(new RequestError(args))})})),deferred.promise},_getItemByQuery:function(camlQuery){var e=Function.validateParameters(arguments,[{name:"camlQuery",type:SP.CamlQuery}],!0);if(e)throw e;var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&camlQuery.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var items=this._list.getItems(camlQuery);this._context.load(items);var self=this;this._context.executeQueryAsync(function(){for(var itemsEnumerator=items.getEnumerator(),resultItemList=[];itemsEnumerator.moveNext();)resultItemList.push(new self._listItemConstructor(itemsEnumerator.get_current()));if(resultItemList.length>1)throw"Result contains more than one element";deferred.resolve(1===resultItemList.length?resultItemList[0]:null)},function(sender,args){deferred.reject(new RequestError(args))})})),deferred.promise}},ListRepository.registerClass("ListRepository"),AppPartsConfigRepository.prototype={_setFieldValues:function(item,model){AppPartsConfigRepository.callBaseMethod(this,"_setFieldValues",[item,model]),item.set_item(FAQ.Fields.AppPartsConfig.AppPartId,model.wpId),item.set_item(FAQ.Fields.AppPartsConfig.Config,JSON.stringify(model.configData))},getByAppPartId:function(appPartId){var camlBuilder=new CamlBuilder,caml=camlBuilder.Where().TextField(FAQ.Fields.AppPartsConfig.AppPartId).EqualTo(appPartId).ToString(),query=new SP.CamlQuery;return query.set_viewXml(String.format("<View><Query>{0}</Query></View>",caml)),this._getItemByQuery(query)}},AppPartsConfigRepository.registerClass("AppPartsConfigRepository",ListRepository),FaqRepository.prototype={_setFieldValues:function(item,model){FaqRepository.callBaseMethod(this,"_setFieldValues",[item,model]),item.set_item(FAQ.Fields.FaqList.Question,model.question),item.set_item(FAQ.Fields.FaqList.Answer,model.answer),item.set_item(FAQ.Fields.FaqList.Order,model.order),item.set_item(FAQ.Fields.FaqList.Expanded,model.expanded),model.faqSetSettings&&item.set_item(FAQ.Fields.FaqList.FolderSettings,JSON.stringify(model.faqSetSettings))},createFaqFolder:function(folderName,settings){var deferred=this._createDeferred(),self=this;return this.createFolder(folderName).then(function(folderItem){folderItem.set_item(FAQ.Fields.FaqList.FolderSettings,JSON.stringify(settings)),folderItem.update(),self._context.load(folderItem),self._context.executeQueryAsync(function(){deferred.resolve(folderItem)},function(sender,error){deferred.reject(new RequestError(error))})},function(error){deferred.reject(error)}),deferred.promise},getOrderedItems:function(){var camlBuilder=new CamlBuilder,caml=camlBuilder.Where().CounterField(FAQ.Fields.ID).NotEqualTo(0).OrderBy(FAQ.Fields.FaqList.Order).ToString(),query=new SP.CamlQuery;return query.set_viewXml(String.format("<View><Query>{0}</Query></View>",caml)),this._getItemsByQuery(query)},updateOrdering:function(faqItems){function findFaqItemById(id){var item=null;return Array.forEach(faqItems,function(faqItem){faqItem.id===id&&(item=faqItem)}),item}var e=Function.validateParameters(arguments,[{name:"faqItems",type:Array,elementType:FaqListItem}]);if(e)throw e;var ids=faqItems.map(function(item){return item.id}),camlBuilder=new CamlBuilder,caml=camlBuilder.Where().CounterField(FAQ.Fields.ID).In(ids).ToString(),camlQuery=new SP.CamlQuery;camlQuery.set_viewXml(String.format("<View><Query>{0}</Query></View>",caml));var deferred=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&camlQuery.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var items=this._list.getItems(camlQuery);this._context.load(items),this._context.executeQueryAsync(Function.createDelegate(this,function(){for(var itemsEnumerator=items.getEnumerator();itemsEnumerator.moveNext();){var dbItem=itemsEnumerator.get_current(),modelItem=findFaqItemById(dbItem.get_id());dbItem.set_item(FAQ.Fields.FaqList.Order,modelItem.order),dbItem.update()}this._context.executeQueryAsync(function(){deferred.resolve()},function(sender,args){deferred.reject(new RequestError(args))})}),function(sender,args){deferred.reject(new RequestError(args))})})),deferred.promise}},FaqRepository.registerClass("FaqRepository",ListRepository),AppPartConfigListItem.registerClass("AppPartConfigListItem",BaseListItem),FaqListItem.registerClass("FaqListItem",BaseListItem),FAQ.SPWebService=function(){function getQueryStringParameter(paramToRetrieve){for(var params=document.URL.split("?")[1].split("&"),i=0;i<params.length;i+=1){var singleParam=params[i].split("=");if(singleParam[0]==paramToRetrieve)return singleParam[1]}}return{getHostWebId:function(){var deferred=angular.injector(["ng"]).get("$q").defer(),hostweburl=decodeURIComponent(getQueryStringParameter("SPHostUrl")),currentContext=SP.ClientContext.get_current(),hostContext=new SP.AppContextSite(currentContext,hostweburl),hostWeb=hostContext.get_web();return currentContext.load(hostWeb),currentContext.executeQueryAsync(function(){deferred.resolve(hostWeb.get_id().toString())},function(sender,error){deferred.reject(new RequestError(error))}),deferred.promise},webProperties:{get:function(key){var deferred=angular.injector(["ng"]).get("$q").defer(),ctx=new SP.ClientContext.get_current,webProperties=ctx.get_web().get_allProperties();return ctx.load(webProperties),ctx.executeQueryAsync(function(){deferred.resolve(webProperties.get_fieldValues()[key])},function(sender,error){deferred.reject(new RequestError(error))}),deferred.promise},set:function(key,value){var deferred=angular.injector(["ng"]).get("$q").defer(),ctx=new SP.ClientContext.get_current,web=ctx.get_web(),webProperties=web.get_allProperties();return ctx.load(webProperties),ctx.executeQueryAsync(function(){webProperties.set_item(key,value),web.update(),ctx.executeQueryAsync(function(){deferred.resolve()},function(sender,error){deferred.reject(new RequestError(error))})},function(sender,error){deferred.reject(new RequestError(error))}),deferred.promise}}}}();
//# sourceMappingURL=faq.app.core.tmp.min.js.map