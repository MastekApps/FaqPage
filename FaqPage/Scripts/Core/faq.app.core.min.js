"use strict";function RequestError(a){a instanceof SP.ClientRequestFailedEventArgs?(this.stackTrace=a.get_stackTrace(),this.message=a.get_message(),this.correlation=a.get_errorTraceCorrelationId(),this.errorCode=a.get_errorCode(),this.details=a.get_errorDetails(),this.errorType=a.get_errorTypeName()):"string"==typeof a&&(this.message=a)}function BaseListItem(a){var b=Function.validateParameters(arguments,[{name:"item",type:SP.ListItem}],!0);if(b)throw b;this.item=a,this.id=a.get_id(),this.created=a.get_item(FAQ.Fields.Created),this.createdBy=a.get_item(FAQ.Fields.CreatedBy),this.modified=a.get_item(FAQ.Fields.Modified),this.modifiedBy=a.get_item(FAQ.Fields.ModifiedBy),this.title=a.get_item(FAQ.Fields.Title)}function ListRepository(a,b){var c=Function.validateParameters(arguments,[{name:"_listTitle",type:String},{name:"listItemConstractor",type:Function}],!0);if(c)throw c;this._listUrl=a,this._listItemConstructor=b,this._context=SP.ClientContext.get_current(),this._loadListDeffered=FAQ.ListService.getListByUrl(this._listUrl),this._loadListDeffered.done(Function.createDelegate(this,function(a){this._list=a})),this.folder=null}function AppPartsConfigRepository(a){AppPartsConfigRepository.initializeBase(this,[a,AppPartConfigListItem])}function FaqRepository(a){FaqRepository.initializeBase(this,[a,FaqListItem])}function AppPartConfigListItem(a){a&&(AppPartConfigListItem.initializeBase(this,[a]),this.wpId=a.get_item(FAQ.Fields.AppPartsConfig.AppPartId),this.configData=JSON.parse(a.get_item(FAQ.Fields.AppPartsConfig.Config)))}function FaqListItem(a){if(a){FaqListItem.initializeBase(this,[a]),this.question=a.get_item(FAQ.Fields.FaqList.Question),this.answer=a.get_item(FAQ.Fields.FaqList.Answer),this.order=a.get_item(FAQ.Fields.FaqList.Order),this.expanded=a.get_item(FAQ.Fields.FaqList.Expanded);var b=a.get_item(FAQ.Fields.FaqList.FolderSettings);this.faqSetSettings=b?JSON.parse(b):{}}}Type.registerNamespace("FAQ.Fields.FaqList"),Type.registerNamespace("FAQ.Fields.AppPartsConfig"),Type.registerNamespace("FAQ.Lists"),Type.registerNamespace("FAQ.ErrorCodes"),Type.registerNamespace("FAQ.ContentTypes"),FAQ.ErrorCodes.FolderAlreadyExists=-2130245363,FAQ.ErrorCodes.IllegalName=-2130575245,FAQ.Lists.FaqUrl="Lists/Faq",FAQ.Lists.AppPartsConfigUrl="Lists/AppPartsConfig",FAQ.Fields.Modified="Modified",FAQ.Fields.Created="Created",FAQ.Fields.ModifiedBy="Editor",FAQ.Fields.CreatedBy="Author",FAQ.Fields.ID="ID",FAQ.Fields.FSObjType="FSObjType",FAQ.Fields.Title="Title",FAQ.Fields.FileLeafRef="FileLeafRef",FAQ.Fields.ContentTypeId="ContentTypeId",FAQ.Fields.FaqList.Question="FAQQuestion",FAQ.Fields.FaqList.Answer="FAQAnswer",FAQ.Fields.FaqList.Order="FAQOrder",FAQ.Fields.FaqList.Expanded="FAQExpanded",FAQ.Fields.FaqList.FolderSettings="FAQFolderSettings",FAQ.Fields.AppPartsConfig.AppPartId="WebPartId",FAQ.Fields.AppPartsConfig.Config="WebPartConfig",FAQ.ContentTypes.FaqFodlerId="0x012000B611673586B24704B0EF576127543759",RequestError.registerClass("RequestError"),FAQ.ListService=function(){var a=$jq.Deferred(),b=SP.ClientContext.get_current(),c=b.get_web().get_lists();return b.load(c,"Include(DefaultViewUrl)"),b.executeQueryAsync(function(){a.resolve()},function(b,c){a.reject(new RequestError(c)),alert(String.fromat(FAQRS.ErrorLoadingList))}),{getListByUrl:function(b){var d=$jq.Deferred();return a.done(function(){for(var a=c.getEnumerator();a.moveNext();){var e=a.get_current();if(-1!=e.get_defaultViewUrl().indexOf(b))return void d.resolve(e)}}),d.promise()}}}(),BaseListItem.registerClass("BaseListItem"),ListRepository.prototype={getItems:function(){return this._getItemsByQuery(SP.CamlQuery.createAllItemsQuery())},getItemById:function(a){var b=Function.validateParameters(arguments,[{name:"id",type:Number}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var b=this._list.getItemById(a);this._context.load(b);var d=this;this._context.executeQueryAsync(function(){var a=new d._listItemConstructor(b);c.resolve(a)},function(a,b){c.reject(new RequestError(b))})})),c.promise},getLastItem:function(){var a=new CamlBuilder,b=a.Where().CounterField(FAQ.Fields.ID).NotEqualTo(0).OrderByDesc(FAQ.Fields.ID).ToString(),c=new SP.CamlQuery;return c.set_viewXml(String.format("<View><Query>{0}</Query><RowLimit>1</RowLimit></View>",b)),this._getItemByQuery(c)},getRootFolders:function(){var a=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var b=new CamlBuilder,c=b.Where().IntegerField(FAQ.Fields.FSObjType).EqualTo(1).ToString(),d=new SP.CamlQuery;d.set_viewXml(String.format("<View><Query>{0}</Query></View>",c));var e=this._list.getItems(d),f=this;this._context.load(e),this._context.executeQueryAsync(function(){for(var b=[],c=e.getEnumerator();c.moveNext();){var d=c.get_current();"Item"!==d.get_item(FAQ.Fields.Title)&&b.push(new f._listItemConstructor(d))}a.resolve(b)},function(b,c){a.reject(new RequestError(c))})})),a.promise},saveItem:function(a){var b=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(b)throw b;return!a.id||a.id<1?this._addItem(a):this._updateItem(a)},deleteItem:function(a){var b=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var b=this._list.getItemById(a.id);this._context.load(b),b.deleteObject(),this._context.executeQueryAsync(function(){c.resolve()},function(a,b){c.reject(new RequestError(b))})})),c.promise},createFolder:function(a){var b=Function.validateParameters(arguments,[{name:"folderName",type:String}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var b=new SP.ListItemCreationInformation;b.set_underlyingObjectType(SP.FileSystemObjectType.folder),b.set_leafName(a);var d=this._list.addItem(b);d.set_item("Title",a),d.update(),this._context.load(d),this._context.executeQueryAsync(function(){c.resolve(d)},function(a,b){c.reject(new RequestError(b))})})),c.promise},_createDeferred:function(){return angular.injector(["ng"]).get("$q").defer()},_addItem:function(a){var b=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var b=new SP.ListItemCreationInformation;this.folder&&b.set_folderUrl(this._getFolderRelativeUrl());var d=this._list.addItem(b);this._setFieldValues(d,a);var e=this;d.update(),this._context.load(d),this._context.executeQueryAsync(function(){var a=new e._listItemConstructor(d);c.resolve(a)},function(a,b){c.reject(new RequestError(b))})})),c.promise},_updateItem:function(a){var b=Function.validateParameters(arguments,[{name:"model",type:this._listItemConstructor}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){var b=this._list.getItemById(a.id);this._context.load(b),this._setFieldValues(b,a);var d=this;b.update(),this._context.executeQueryAsync(function(){var a=new d._listItemConstructor(b);c.resolve(a)},function(a,b){c.reject(new RequestError(b))})})),c.promise},_setFieldValues:function(a,b){a.set_item(FAQ.Fields.Title,b.title),b.fileLeafRef&&a.set_item(FAQ.Fields.FileLeafRef,b.fileLeafRef)},_getFolderRelativeUrl:function(){var a=_spPageContextInfo.webServerRelativeUrl.endsWith("/")?_spPageContextInfo.webServerRelativeUrl:_spPageContextInfo.webServerRelativeUrl+"/";return String.format("{0}{1}/{2}",a,this._listUrl,this.folder)},_getItemsByQuery:function(a){var b=Function.validateParameters(arguments,[{name:"camlQuery",type:SP.CamlQuery}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&a.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var b=this._list.getItems(a);this._context.load(b);var d=this;this._context.executeQueryAsync(function(){for(var a=b.getEnumerator(),e=[];a.moveNext();)e.push(new d._listItemConstructor(a.get_current()));c.resolve(e)},function(a,b){c.reject(new RequestError(b))})})),c.promise},_getItemByQuery:function(a){var b=Function.validateParameters(arguments,[{name:"camlQuery",type:SP.CamlQuery}],!0);if(b)throw b;var c=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&a.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var b=this._list.getItems(a);this._context.load(b);var d=this;this._context.executeQueryAsync(function(){for(var a=b.getEnumerator(),e=[];a.moveNext();)e.push(new d._listItemConstructor(a.get_current()));if(e.length>1)throw"Result contains more than one element";c.resolve(1===e.length?e[0]:null)},function(a,b){c.reject(new RequestError(b))})})),c.promise}},ListRepository.registerClass("ListRepository"),AppPartsConfigRepository.prototype={_setFieldValues:function(a,b){AppPartsConfigRepository.callBaseMethod(this,"_setFieldValues",[a,b]),a.set_item(FAQ.Fields.AppPartsConfig.AppPartId,b.wpId),a.set_item(FAQ.Fields.AppPartsConfig.Config,JSON.stringify(b.configData))},getByAppPartId:function(a){var b=new CamlBuilder,c=b.Where().TextField(FAQ.Fields.AppPartsConfig.AppPartId).EqualTo(a).ToString(),d=new SP.CamlQuery;return d.set_viewXml(String.format("<View><Query>{0}</Query></View>",c)),this._getItemByQuery(d)}},AppPartsConfigRepository.registerClass("AppPartsConfigRepository",ListRepository),FaqRepository.prototype={_setFieldValues:function(a,b){FaqRepository.callBaseMethod(this,"_setFieldValues",[a,b]),a.set_item(FAQ.Fields.FaqList.Question,b.question),a.set_item(FAQ.Fields.FaqList.Answer,b.answer),a.set_item(FAQ.Fields.FaqList.Order,b.order),a.set_item(FAQ.Fields.FaqList.Expanded,b.expanded),b.faqSetSettings&&a.set_item(FAQ.Fields.FaqList.FolderSettings,JSON.stringify(b.faqSetSettings))},createFaqFolder:function(a,b){var c=this._createDeferred(),d=this;return this.createFolder(a).then(function(a){a.set_item(FAQ.Fields.FaqList.FolderSettings,JSON.stringify(b)),a.update(),d._context.load(a),d._context.executeQueryAsync(function(){c.resolve(a)},function(a,b){c.reject(new RequestError(b))})},function(a){c.reject(a)}),c.promise},getOrderedItems:function(){var a=new CamlBuilder,b=a.Where().CounterField(FAQ.Fields.ID).NotEqualTo(0).OrderBy(FAQ.Fields.FaqList.Order).ToString(),c=new SP.CamlQuery;return c.set_viewXml(String.format("<View><Query>{0}</Query></View>",b)),this._getItemsByQuery(c)},updateOrdering:function(a){function b(b){var c=null;return Array.forEach(a,function(a){a.id===b&&(c=a)}),c}var c=Function.validateParameters(arguments,[{name:"faqItems",type:Array,elementType:FaqListItem}]);if(c)throw c;var d=a.map(function(a){return a.id}),e=new CamlBuilder,f=e.Where().CounterField(FAQ.Fields.ID).In(d).ToString(),g=new SP.CamlQuery;g.set_viewXml(String.format("<View><Query>{0}</Query></View>",f));var h=this._createDeferred();return this._loadListDeffered.done(Function.createDelegate(this,function(){this.folder&&g.set_folderServerRelativeUrl(this._getFolderRelativeUrl());var a=this._list.getItems(g);this._context.load(a),this._context.executeQueryAsync(Function.createDelegate(this,function(){for(var c=a.getEnumerator();c.moveNext();){var d=c.get_current(),e=b(d.get_id());d.set_item(FAQ.Fields.FaqList.Order,e.order),d.update()}this._context.executeQueryAsync(function(){h.resolve()},function(a,b){h.reject(new RequestError(b))})}),function(a,b){h.reject(new RequestError(b))})})),h.promise}},FaqRepository.registerClass("FaqRepository",ListRepository),AppPartConfigListItem.registerClass("AppPartConfigListItem",BaseListItem),FaqListItem.registerClass("FaqListItem",BaseListItem),FAQ.SPWebService=function(){function a(a){for(var b=document.URL.split("?")[1].split("&"),c=0;c<b.length;c+=1){var d=b[c].split("=");if(d[0]==a)return d[1]}}return{getHostWebId:function(){var b=angular.injector(["ng"]).get("$q").defer(),c=decodeURIComponent(a("SPHostUrl")),d=SP.ClientContext.get_current(),e=new SP.AppContextSite(d,c),f=e.get_web();return d.load(f),d.executeQueryAsync(function(){b.resolve(f.get_id().toString())},function(a,c){b.reject(new RequestError(c))}),b.promise},webProperties:{get:function(a){var b=angular.injector(["ng"]).get("$q").defer(),c=new SP.ClientContext.get_current,d=c.get_web().get_allProperties();return c.load(d),c.executeQueryAsync(function(){b.resolve(d.get_fieldValues()[a])},function(a,c){b.reject(new RequestError(c))}),b.promise},set:function(a,b){var c=angular.injector(["ng"]).get("$q").defer(),d=new SP.ClientContext.get_current,e=d.get_web(),f=e.get_allProperties();return d.load(f),d.executeQueryAsync(function(){f.set_item(a,b),e.update(),d.executeQueryAsync(function(){c.resolve()},function(a,b){c.reject(new RequestError(b))})},function(a,b){c.reject(new RequestError(b))}),c.promise}}}}();
//# sourceMappingURL=faq.app.core.min.js.map